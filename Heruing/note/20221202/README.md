### **2022-12-02**

#### 동적 메모리 할당

- 컴퓨터 프로그래밍에서 실행 시간동안 사용할 메모리 공간을 할당하는 것
- 사용이 끝나면 반납하여 다음 요구 시 재할당
- 프로그램 실행 순간 사용할 메모리 크기를 고려하는 정적 메모리 할당과는 대조적



동적으로 할당된 메모리는 명시적으로 해제 하거나 쓰레기 수집 전까지 유지
C/C++은 쓰레기 수집이 없으므로, 사용자가 해제하기 전까지 유지
동적 할당은 프로세스의 힙 영역에서 할당되므로 프로세스 종료 시 OS에 리소스가 반납됨

프로세스가 실행 중일 때는 동적 할당된 영역이 유지되므로 힙 영역의 크기를 넘어서 할당할 수 없음
그러므로 사용이 완료된 영역은 반납하는 것이 유리함 → 함수를 통해 해제

수나 변수 영역을 벗어나면 자동으로 공간 해제가 이루어지는 스택을 사용한 자동 변수와 대조적
정적 메모리 할당은 프로세스 시작부터 끝까지 정해진 메모리 양으로 한정되지만, 동적 할당은
과정에 따라 필요한 메모리를 요구하여 할당 받고 해제하는 것이 가능



#### 힙 영역

- 보다 큰 크기의 데이터를 담고자 동적으로 할당하는 메모리 공간을 지칭
  - 정적 메모리 할당은 스택 영역에 위치

프로그램 코드에서 메모리 할당이 주어지면 라이브러리나 모듈이 지정된 크기의 힙 공간에서
사용 가능한 곳을 예약 상태로 만들고, 핸들이나 포인터를 반환

실행 시간에 크기가 결정되는 동적 배열 및 리스트와 같은 경우는 힙을 사용하는 것이 공간 효율적

C언어의 경우 명시적으로 반환하지 않을 경우 메모리 누수의 원인

메모리 관리를 자동으로 해주는 언어는 쓰레기 수집기로 인한 성능 저하 발생 가능

스택 메모리는 순서대로 쌓이는 형태이고 탐색 시 Top부터 순서대로 혹은 주소값에 대한 탐색
메모리가 추가될 때는 추가로 쌓고, 해제 시킬 때는 가장 위를 없애는 가장 간단한 구조

힙 메모리는 쌓인다는 개념보다는 더미로 존재하는 것에 가까움
이를 활용하기 위해서 스택 메모리에 포인터 개념으로 주소 정보를 가지고 있으며
힙 공간을 지정하는 방식으로 활용함

**힙 메모리를 사용하는 이유**

1. Life cycle
   - 스택 메모리는 함수 등이 호출된 후 모든 데이터가 함께 사라짐
   - 포인터로 지정 및 저장하면 데이터는 남길 수 있음
2. Large size
   - 스택 메모리를 무작정 확장하며 쌓아갈 수 없음
   - 힙 메모리 공간에 큰 데이터를 위치시키고 스택 메모리는 주소만 지정
3. Dynamic
   - 스택 메모리는 컴파일 단계에서 결정(정적 메모리 할당)
   - 동적 할당을 위한 힙 메모리 사용

#### 장단점

- 장점
  - 원하는 크기만큼만 할당되므로 경제적
  - 할당된 메모리 크기를 조절할 수 있음
- 단점
  - 명시적으로 메모리를 해제하지 않을 때 발생하는 문제



#### 동적 할당 방법

![img](https://upload.wikimedia.org/wikipedia/commons/2/22/C_MemMap_Exam_VS.png)

> *배치 명은 CPU와 컴파일러마다 다름

C로 프로그램 작성 후 실행시키면 위와 같은 메모리 구조를 갖고, 동적 할당의 경위 <a style="color: orange; font-weight:bold;">힙</a> 영역에서 할당
malloc 등의 함수를 통해 할당 요구를 하면 포인터를 넘

|    함수     |                             기능                             |
| :---------: | :----------------------------------------------------------: |
| **malloc**  |       size 바이트의 메모리를 힙에서 할당하여 반환한다.       |
| **calloc**  | (num * size) 바이트의 메모리를 힙에서 할당하고 포인터값을 반환한다. |
| **realloc** | ptr이 가리키는 메모리를 size 바이트만큼 힙에서 재할당하여 반환한다. |
|  **free**   | ptr이 가리키는 메모리를 해제한다.<br/>해제 전까지 계속 존재하므로 필요없으면 이 함수에 의해 해제해야 한다. |

`malloc`, `calloc`함수로 동적 할당하며 영역에 여유가 있다면 할당, 실패하면 `NULL`반환

해제할 경우 재할당이 가능한 상태가 됨

힙 관리 데이터가 필요하기 때문에 실제 메모리 할당 크기와 요청 크기는 다름
경우에 따라 프로그램이 정해진 규칙에 따라 크기를 할당함